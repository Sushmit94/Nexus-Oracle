# Predictive Router Oracle - Model Configuration
# Configuration for AI/ML prediction models

# Statistical anomaly detection model
statistical_model:
  name: "IsolationForest"
  type: "anomaly_detection"
  parameters:
    n_estimators: 100
    contamination: 0.1
    max_samples: "auto"
    random_state: 42
  features:
    - latency_mean
    - latency_std
    - latency_p99
    - throughput
    - error_rate
    - missed_heartbeats
  window_size: 60             # Seconds of data to analyze
  update_interval: 10         # Seconds between model updates

# ML failure prediction model
ml_model:
  name: "GradientBoostingClassifier"
  type: "binary_classification"
  parameters:
    n_estimators: 200
    max_depth: 6
    learning_rate: 0.1
    min_samples_split: 10
    min_samples_leaf: 5
  features:
    - latency_trend
    - latency_volatility
    - throughput_change
    - error_rate_change
    - heartbeat_stability
    - historical_failures
    - time_since_last_failure
    - node_age_days
  target: "failure_within_5min"
  threshold: 0.5
  model_path: "models/failure_predictor.pkl"

# LLM reasoning agent configuration
llm_agent:
  name: "FailureReasoningAgent"
  type: "reasoning"
  provider: "openai"          # Options: openai, anthropic, local
  model: "gpt-4"
  temperature: 0.3
  max_tokens: 500
  system_prompt: |
    You are an expert infrastructure reliability engineer analyzing miner/validator node health.
    Given metrics data, determine if the node is likely to fail soon.
    Consider: latency patterns, error rates, throughput trends, and heartbeat reliability.
    Provide a failure probability (0-1) and brief explanation.
  response_format:
    failure_probability: "float"
    confidence: "float"
    reasoning: "string"
    recommended_action: "string"

# Arbitration nexus configuration
arbitration_nexus:
  name: "ConsensusArbitrator"
  voting_method: "weighted_average"  # Options: weighted_average, majority, unanimous
  models:
    - name: "statistical"
      weight: 0.3
      required: true
    - name: "ml"
      weight: 0.4
      required: true
    - name: "llm"
      weight: 0.3
      required: false           # LLM is optional (cost considerations)
  consensus_rules:
    min_agreement: 0.7          # 70% agreement required
    confidence_boost: 0.1       # Boost confidence if all agree
    outlier_penalty: 0.2        # Reduce confidence if outlier detected
  fallback:
    on_disagreement: "conservative"  # Options: conservative, aggressive, ml_only
    on_timeout: "last_known"

# Feature engineering
feature_engineering:
  time_windows:
    - 60      # 1 minute
    - 300     # 5 minutes
    - 900     # 15 minutes
    - 3600    # 1 hour
  aggregations:
    - mean
    - std
    - min
    - max
    - p50
    - p95
    - p99
  derived_features:
    - latency_trend            # Slope of latency over time
    - throughput_momentum      # Rate of change
    - error_acceleration       # Second derivative of errors

# Training configuration
training:
  batch_size: 32
  epochs: 100
  validation_split: 0.2
  early_stopping_patience: 10
  learning_rate_scheduler: "cosine"
  data_augmentation: true
  class_weights: "balanced"

# Inference configuration
inference:
  batch_size: 1
  timeout_ms: 1000
  cache_predictions: true
  cache_ttl_seconds: 30
  async_inference: true
  fallback_on_error: "conservative"